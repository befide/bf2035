---
import type { CollectionEntry } from 'astro:content';

import { getImage } from 'astro:assets';

export interface Props {
  section: CollectionEntry<'sections'>;
}

const { section } = Astro.props;

const { title, sectionNumber, supertitle, subtitle, backgroundImageSrc } =
  section.data;
const { Content } = await section.render();

const optimizedBackground =
  backgroundImageSrc &&
  (process.env.NODE_ENV === 'production'
    ? await getImage({
        src: backgroundImageSrc.src,
        format: 'webp',
        width: 4960,
        height: 3508,
      })
    : backgroundImageSrc);
---

<div class="part">
  <div
    class="spread__page left"
    style={optimizedBackground
      ? `background-image: url(${optimizedBackground.src})`
      : ``}
  >
    <div class="spread__page-grid debug-overlay">
      <Content />
    </div>
  </div>
  <div
    class="spread__page right"
    style={optimizedBackground
      ? `background-image: url(${optimizedBackground.src})`
      : ``}
  >
    <div class="spread__page-grid debug-overlay">
      <header class="spread__header">
        {
          sectionNumber && (
            <div class="spread__sectionNumber">
              <span set:html={sectionNumber} />
            </div>
          )
        }

        {
          supertitle && (
            <div class="spread__supertitle">
              <span set:html={supertitle} />
            </div>
          )
        }
        {
          title && (
            <h1 class="spread__title">
              <span set:html={title} />
            </h1>
          )
        }
        {
          subtitle && (
            <div class="spread__subtitle">
              <span set:html={subtitle} />
            </div>
          )
        }
      </header>

      <Content />
    </div>
  </div>
</div>

<style lang="stylus">
 
.cover, .part

  
  .spread__header
    grid-area: 1 / 4 / 11 / 13
    text-align right


  .spread__supertitle, .spread__subtitle, .spread__title
    right 0rem


    span
      margin-right calc(-1 * var(--page__margin__outside) - 1 * var(--bleed))
      margin-left 0
      padding-right calc(1 * var(--page__margin__outside) - 1 * var(--bleed))
      padding-left 1rem;
      padding-top: 2px;
      padding-bottom: 2px; 
      border-right: 0
      box-shadow 0px 0 2px 0px rgba(0, 0, 0, 0.5)
      
  .spread__sectionNumber {
    display: none;
  }

  .spread__title {
    top 2rem;
    color white;
    line-height 3rem;
    font-size 2rem;
    height: 3rem
  }

  .spread__supertitle, .spread__subtitle {
    font-size 1.3rem;
    line-height 2rem;
  }
  .spread__supertitle {
    top 0rem;
  }
  .spread__subtitle {
    top 5rem;
   }



  </style>
