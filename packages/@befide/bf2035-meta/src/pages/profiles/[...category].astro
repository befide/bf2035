---
import { allCommunityTopLevelOrganizations, getOrganizationCategories } from '@/utils';

import { hiddenCategories } from '@/stores/profilesCategoryFilterStore';

import { CardGrid, Card, LinkButton } from '@astrojs/starlight/components';
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';

import { getLangFromUrl, useTranslations } from '@/i18n/utils';
const t = useTranslations(getLangFromUrl(Astro.url));

const categories = await getOrganizationCategories();

export async function getStaticPaths() {
	return [...(await getOrganizationCategories()), undefined].map((category) => ({
		params: { category },
		props: { category },
	}));
}
const { category } = Astro.props;
const organizations = (await allCommunityTopLevelOrganizations()).filter(
	(o) => !category || o.befideOrganizationCategories.includes(category)
);
---

<StarlightPage frontmatter={{ title: 'Profiles Index' }}>
	<p>
		This page lists all scientific institutions in Germany or, in the case of significant German
		funding, abroad, where accelerator research is carried out.
	</p>
	<div id="organization-category-filter-holder">
		<ul>
			{
				categories.map((c) => (
					<LinkButton
						class={'category--' + c}
						size="small"
						href={'/profiles/' + c}
						icon={c === category ? 'approve-check' : undefined}
					>
						{t('organizationCategory.' + c)}
					</LinkButton>
				))
			}
		</ul>
	</div>
	<div id="list-holder">
		<CardGrid>
			{
				organizations.map((o) => (
					<Card
						title={o.label.short.en || ''}
						description={o.label.fullName.en}
						categories={o.befideOrganizationCategories}
					/>
				))
			}</CardGrid
		>
	</div>

	<style is:global>
		#organization-category-filter-holder ul {
			list-style: none;
			display: flex;
			margin-bottom: 2rem;
		}

		#organization-category-filter-holder ul li {
			flex: 1;
		}
		.hide-international .sl-link-card-2.international {
			display: none;
		}
		.hide-hgf .sl-link-card-2.hgf {
			display: none;
		}
		.hide-university .sl-link-card-2.university {
			display: none;
		}
		.hide-mpg .sl-link-card-2.mpg {
			display: none;
		}
		.hide-national .sl-link-card-2.national {
			display: none;
		}
		.hide-fraunhofer .sl-link-card-2.fraunhofer {
			display: none;
		}
	</style>
</StarlightPage>
