---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';

import { allCommunityTopLevelOrganizations, getFacilities } from '@/utils';
import ProfileOrganizationTreeTable from '@/components/domain/ProfileOrganizationTreeTable.astro';
import ProfileFacilityTreeTable from '@/components/domain/ProfileFacilityTreeTable.astro';
import ProfileCourses from '@/components/domain/ProfileCourses.astro';
import ProfileTheses from '@/components/domain/ProfileTheses.astro';

export async function getStaticPaths() {
  return (await allCommunityTopLevelOrganizations()).map((organization) => ({
    params: { id: organization.id },
    props: { organization }
  }));
}

const { organization } = Astro.props;

const userFacilitiesInDesign = await getFacilities({
  hostId: organization.id,
  isUserFacility: true,
  lifeCycleCategory: 1
});
const userFacilitiesInConstruction = await getFacilities({
  hostId: organization.id,
  isUserFacility: true,
  lifeCycleCategory: 2
});
const userFacilitiesInOperation = await getFacilities({
  hostId: organization.id,
  isUserFacility: true,
  lifeCycleCategory: 3
});
const testFacilities = await getFacilities({
  hostId: organization.id,
  isUserFacility: false
});


---

<StarlightPage frontmatter={{ title: organization.label.fullName.en }}>
  <h2>Working Groups</h2>

  <ProfileOrganizationTreeTable rootId={organization.id} />

  <h2>Facilities</h2>

  {userFacilitiesInOperation.length > 0 && (
  <h3>User Facilities (in operation)</h3>

  <ProfileFacilityTreeTable
    items={userFacilitiesInOperation}
    
  />)}

  {userFacilitiesInConstruction.length && (
  <h3>User Facilities (preparation/construction/commissinoning)</h3>

  <ProfileFacilityTreeTable
    items={userFacilitiesInConstruction}
  />)}

  {userFacilitiesInDesign.length && (
  <h3>User Facilities (design)</h3>
  <ProfileFacilityTreeTable
    items={userFacilitiesInDesign}
  />
  )}
  {testFacilities.length && (
  
    <h3>Test Facilities</h3>
    <ProfileFacilityTreeTable items={testFacilities} />
    
  )}


  <h2>Courses</h2>

  <ProfileCourses universityId={organization.id} />

  <h2>Doctoral Theses</h2>

  <ProfileTheses universityId={organization.id} />
</StarlightPage>
