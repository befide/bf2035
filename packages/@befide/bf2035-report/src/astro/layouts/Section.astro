---
import type { CollectionEntry } from "astro:content";

import { getImage } from "astro:assets";

import LinkCard from "@ui/LinkCard.astro";
import CardGrid from "@ui/CardGrid.astro";

export interface Props {
  section: CollectionEntry<"sections">;
}

const { section } = Astro.props;

const {
  title,
  sectionNumber,
  supertitle,
  subtitle,
  pageType = "spread",
  backgroundImageSrc,
} = section.data;
const { Content } = await section.render();

const optimizedBackground =
  backgroundImageSrc &&
  (process.env.NODE_ENV === "production"
    ? await getImage({
        src: backgroundImageSrc.src,
        format: "webp",
        width: 4960,
        height: 3508,
      })
    : backgroundImageSrc);
---

<div class="bleeding-spread">
  <div class={"spread " + pageType}>
    {
      (pageType === "spread" || pageType === "left") && (
        <div
          class="spread__page left"
          style={
            optimizedBackground
              ? `background-image: url(${optimizedBackground.src})`
              : ``
          }
        >
          <div class="spread__page-grid debug-overlay">
            <header class="spread__header" transition:animate="slide">
              {sectionNumber && (
                <div class="spread__sectionNumber">
                  <span>{sectionNumber}</span>
                </div>
              )}

              {supertitle && (
                <div class="spread__supertitle">
                  <span>{supertitle}</span>
                </div>
              )}
              {title && (
                <h1 class="spread__title">
                  <span>{title}</span>
                </h1>
              )}
              {subtitle && (
                <div class="spread__subtitle">
                  <span>{subtitle}</span>
                </div>
              )}
            </header>

            <Content components={{ LinkCard, CardGrid }} />
          </div>
        </div>
      )
    }
    {
      (pageType === "spread" || pageType === "right") && (
        <div
          class="spread__page right"
          style={
            optimizedBackground
              ? `background-image: url(${optimizedBackground.src})`
              : ``
          }
        >
          <div class="spread__page-grid debug-overlay">
            {pageType === "right" && (
              <header class="spread__header" transition:animate="slide">
                {sectionNumber && (
                  <div class="spread__sectionNumber">
                    <span>{sectionNumber}</span>
                  </div>
                )}
                {supertitle && (
                  <div class="spread__supertitle">
                    <span>{supertitle}</span>
                  </div>
                )}
                <h1 class="spread__title">
                  <span>{title}</span>
                </h1>
                {subtitle && (
                  <div class="spread__subtitle">
                    <span>{subtitle}</span>
                  </div>
                )}
              </header>
            )}
            <Content components={{ LinkCard, CardGrid }} />
          </div>
        </div>
      )
    }
  </div>
</div>
